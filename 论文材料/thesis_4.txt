【阶段四：安全加固与边界防御（Security Hardening）论文素材】

1. 学术背景/动机
将用户代码发送给外部 LLM 服务意味着系统不仅要“识别代码漏洞”，还要“防止用户输入攻击系统本身”。这一阶段的学术动机可表述为：在 LLM 驱动的软件中，输入面同时具备传统 Web 安全面（请求洪泛、超大负载、滥用攻击）与 LLM 特有安全面（凭据泄露、提示词注入、成本型 DoS）。因此需要在应用层建立边界防御，以降低资源消耗、提升可用性并控制数据外泄风险。

2. 核心方案说明
阶段四围绕三类防御机制展开：
（1）输入大小限制（Input Validation）：在全局中间件中基于 `Content-Length` 做快速拒绝，超限请求直接返回 HTTP 413，从而避免后续解析与模型调用开销。
（2）限流（Rate Limiting）：实现内存版限流器，以客户端 IP 维度在固定时间窗内限制请求次数。超过阈值时返回 HTTP 429，防止恶意刷接口导致模型调用成本失控。
（3）敏感凭据脱敏（Credential Scrubbing）：在把代码发送给 LLM 之前，对可能出现的密钥模式进行正则匹配与替换，降低“将硬编码凭据外发给第三方服务”的风险。

3. 论文加分项（Academic Highlights）
（1）成本型攻击防御：把 LLM 调用视为一种“昂贵资源”，限流与负载限制本质上是在做经济型 DoS 防护，可作为论文创新视角进行阐述。
（2）数据外泄面控制：凭据脱敏体现“数据最小化”原则，可与合规（PII/secret）议题结合。
（3）多层防线（Defense-in-Depth）：在路由层之前进行输入限幅，在业务入口进行限流，在模型调用前做脱敏，形成分层防御叙事结构。

4. 实验/验证数据
（1）负载限制：全局中间件检测 `Content-Length`，超限返回 HTTP 413（实现于 `backend/app/middleware/security.py`，挂载于 `backend/main.py:12-13`）。
（2）请求限流：默认每 IP 每 60 秒最多 10 次请求，超过返回 HTTP 429（实现于 `backend/app/core/rate_limiter.py:9-24`，在 `backend/app/api/v1/endpoints/analyze.py:9-12` 调用）。
（3）凭据脱敏：在 `analyze` 路由中对 `code` 进行脱敏后再发送给 LLM（`backend/app/api/v1/endpoints/analyze.py:21-22`）。
（4）一致性提示（可作为论文“工程缺陷分析”）：中间件默认参数注释与实际挂载参数存在不一致（默认 10KB，但挂载时设置为 100KB；返回错误消息仍提示 10KB）。该现象可作为“安全策略与实现一致性”案例，在论文中强调配置一致性的重要性。

